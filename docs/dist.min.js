var e,t="readystatechange";var n=e=>`color: ${e}; font-weight: bold;`,o="#f012be";function s({component:e,e:t,module:s,color:r}){if("boolean"==typeof __DEV__&&!__DEV__)return;const i=t.type;"object"==typeof DEBUG_IGNORE&&DEBUG_IGNORE?.has(i)||(console.groupCollapsed(`${s}> %c${i}%c on %c${e}`,n(r||o),"",n("#1a80cc")),console.log(t),t.target&&console.log(t.target),console.groupEnd())}var r=class e{#e;#t=[];constructor(e){this.#e=e}get(){return this.#e}update(e){this.#e!==e&&(this.#e=e,this.#t.forEach((t=>{t(e)})))}onChange(e){return this.#t.push(e),()=>{this.#t.splice(this.#t.indexOf(e)>>>0,1)}}subscribe(e){return e(this.#e),this.onChange(e)}map(t){const n=new e(t(this.#e));return this.onChange((e=>n.update(t(e)))),n}},i=class e{#e;#t=[];constructor(e){this.#e=e}get(){return this.#e}update(e){if("object"!=typeof e||null===e)throw new Error("value must be an object");for(const t of Object.keys(e))if(this.#e[t]!==e[t]){this.#e={...e},this.#t.forEach((e=>{e(this.#e)}));break}}onChange(e){return this.#t.push(e),()=>{this.#t.splice(this.#t.indexOf(e)>>>0,1)}}subscribe(e){return e(this.#e),this.onChange(e)}map(t){const n=new e(t(this.#e));return this.onChange((e=>n.update(t(e)))),n}},a={};function c(e,t){if(!e)throw new Error(t)}function l(n,o){c("string"==typeof o&&!!o,"Component name must be a non-empty string"),c(!a[o],`The component of the given name is already registered: ${o}`);const r=`${o}-ðŸ’Š`,i=e=>{if(!e.classList.contains(r)){const t=t=>{e.addEventListener(`__unmount__:${o}`,t,{once:!0})};e.classList.add(o),e.classList.add(r),t((()=>e.classList.remove(r)));const i=(t,n,r,i)=>{if("function"==typeof n?(i=n,n=void 0,r=void 0):"function"==typeof r&&"string"==typeof n?(i=r,r=void 0):"function"==typeof r&&"object"==typeof n&&(i=r,r=n,n=void 0),"function"!=typeof i)throw new Error(`Cannot add event listener: The handler must be a function, but ${typeof i} is given`);!function(e,t,n,o,r,i){h(n),u(o);const a=n=>{r&&![].some.call(t.querySelectorAll(r),(e=>e===n.target||e.contains(n.target)))||(s({module:"ðŸ’Š",color:"#e0407b",e:n,component:e}),o(n))};t.addEventListener(`__unmount__:${e}`,(()=>{t.removeEventListener(n,a,i)}),{once:!0}),t.addEventListener(n,a,i)}(o,e,t,i,n,r)},a=(n,r)=>{h(n),u(r);const i=t=>{e===t.target||e.contains(t.target)||(s({module:"outside",color:"#39cccc",e:t,component:o}),r(t))};document.addEventListener(n,i),t((()=>document.removeEventListener(n,i)))},c=(e,n)=>{t(e.subscribe(n))},l=n({el:e,on:i,onOutside:a,onUnmount:t,query:t=>e.querySelector(t),queryAll:t=>e.querySelectorAll(t),subscribe:c});"string"==typeof l?e.innerHTML=l:l&&"function"==typeof l.then&&l.then((t=>{"string"==typeof t&&(e.innerHTML=t)}))}};i.sel=`.${o}:not(.${r})`,a[o]=i,"complete"===document.readyState?d():function(n=document){return e??=new Promise((e=>{const o=()=>{"complete"===n.readyState&&(e(),n.removeEventListener(t,o))};n.addEventListener(t,o),o()})),e}().then((()=>{d(o)}))}function u(e){c("function"==typeof e,`Cannot add an event listener: The event handler must be a function, ${typeof e} (${e}) is given`)}function h(e){c("string"==typeof e,`Cannot add an event listener: The event type must be a string, ${typeof e} (${e}) is given`)}function d(e,t){let n;e?(!function(e){c("string"==typeof e,"The name should be a string"),c(!!a[e],`The component of the given name is not registered: ${e}`)}(e),n=[e]):n=Object.keys(a),n.map((e=>{[].map.call((t||document).querySelectorAll(a[e].sel),a[e])}))}function f(e,t){c(!!a[e],`The component of the given name is not registered: ${e}`),t.dispatchEvent(new CustomEvent(`__unmount__:${e}`))}export{i as GroupSignal,r as Signal,d as mount,l as register,f as unmount};
/*! Cell v0.7.5 | Copyright 2024 Yoshiya Hinosawa and Capsule contributors | MIT license */